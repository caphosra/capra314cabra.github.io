<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="caphosra"><meta name=description content="PowershellでBashでいうsudoのような管理者権限で実行できるようにする方法を紹介します"><meta name=keywords content="sudo,powershell"><meta name=twitter:card content="summary"><meta name=twitter:image content="https://caphosra.net/images/icon.webp"><meta name=twitter:title content="Powershellでsudoしてみたい話"><meta name=twitter:description content="PowershellでBashでいうsudoのような管理者権限で実行できるようにする方法を紹介します"><meta property="og:url" content="https://caphosra.net/posts/powershell-sudo/"><meta property="og:site_name" content="caphosra note"><meta property="og:title" content="Powershellでsudoしてみたい話"><meta property="og:description" content="PowershellでBashでいうsudoのような管理者権限で実行できるようにする方法を紹介します"><meta property="og:locale" content="ja"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-12-11T22:28:26+09:00"><meta property="article:modified_time" content="2024-01-07T13:18:38+09:00"><meta property="article:tag" content="Powershell"><base href=https://caphosra.net/posts/powershell-sudo/><title>Powershellでsudoしてみたい話 · caphosra note
</title><link rel=canonical href=https://caphosra.net/posts/powershell-sudo/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous><style defer>@import 'https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&display=swap'</style><link rel=stylesheet href=https://caphosra.net/css/coder.min.70f3e69b472ec0878dad3a4928700ac7d4dc99e9a09a656210c5862dcf0acfe7.css integrity="sha256-cPPmm0cuwIeNrTpJKHAKx9TcmemgmmViEMWGLc8Kz+c=" crossorigin=anonymous media=screen><script src=https://cdn.jsdelivr.net/npm/gist-embed@1.0.3/dist/gist-embed.min.js defer></script><link rel=icon type=image/png href=https://caphosra.net/images/logo/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://caphosra.net/images/logo/favicon-16x16.png sizes=16x16><meta name=generator content="Hugo 0.139.3"><style type=text/css>.icon{font-size:2.5em}</style></head><body class=colorscheme-light><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://caphosra.net/>caphosra note
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://caphosra.net/>About</a></li><li class=navigation-item><a class=navigation-link href=https://caphosra.net/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=https://caphosra.net/tags/>Tags</a></li><li class=navigation-item><a class=navigation-link href=https://caphosra.net/archives/>Archives</a></li><li class=navigation-item><a class=navigation-link href=https://github.com/caphosra>GitHub</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=https://caphosra.net/en/posts/powershell-sudo/>English</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://caphosra.net/posts/powershell-sudo/>Powershellでsudoしてみたい話</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2019-12-11T22:28:26+09:00>12月 11, 2019
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
1分で読めます</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=https://caphosra.net/tags/powershell/>Powershell</a></span></div></div></header><div class=post-content><p>今回紹介することはタイトルそのままです。<br>PowershellではBashの<code>sudo</code>のように簡単に管理者権限で実行出来るようにするコマンドがありません。<br>そこで、それとほぼ同等なものを作りたい、というのが今回の話題です。<br>早速、始めて行きましょう。</p><h2 id=手元の環境>手元の環境
<a class=heading-link href=#%e6%89%8b%e5%85%83%e3%81%ae%e7%92%b0%e5%a2%83><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>Powershell 6.2.3</p><p>私が使っているPowershellはWindowsに標準でインストールされている.NET Framework依存のものではなく、
.NET Core依存のものです。これはWindowsだけでなくmacOSやLinuxでも動くのでWindows以外を使っている方もインストール出来ます。</p><p>以降、Powershellの実行ファイル名をpwsh.exeとしていますが、.NET Framework依存のものをお使いの方は適宜powershell.exeで読み替えてください。</p><h2 id=コマンドの実装方針>コマンドの実装方針
<a class=heading-link href=#%e3%82%b3%e3%83%9e%e3%83%b3%e3%83%89%e3%81%ae%e5%ae%9f%e8%a3%85%e6%96%b9%e9%87%9d><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p><code>sudo</code>と同等な機能をもった関数を実装し、<code>sudo</code>という名前のAliasとして登録する。</p><h2 id=方法>方法
<a class=heading-link href=#%e6%96%b9%e6%b3%95><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>まず、Powershellを起動し、<code>$profile</code>の値を読みます。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#aa89ea>pwsh</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># PowerShell 6.2.3</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># Copyright (c) Microsoft Corporation. All rights reserved.</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># https://aka.ms/pscore6-docs</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># Type &#39;help&#39; to get help.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#dcaeea>$profile</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># C:\.....\Microsoft.PowerShell_profile.ps1</span>
</span></span></code></pre></div><p>続いて読んだパスのファイルを開きます。<br>お好みのソフトで開きましょう。因みに私はVisual Studio Codeで開きました。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#aa89ea>code</span> <span style=color:#dcaeea>$profile</span>
</span></span></code></pre></div><p>開けたら以下のようなコードを書きます。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># 管理者権限で実行する関数</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>function</span> <span style=color:#e5c07b>SudoRun</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic># $programにコマンドを詰める</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>foreach</span><span style=color:#abb2bf>(</span><span style=color:#dcaeea>$arg</span> <span style=color:#76a9f9>in</span> <span style=color:#dcaeea>$args</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>    <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#dcaeea>$program</span> <span style=color:#abb2bf>=</span> <span style=color:#63c381>&#34;</span><span style=color:#dcaeea>$program</span><span style=color:#63c381> </span><span style=color:#dcaeea>$arg</span><span style=color:#63c381>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic># Powershellにより管理者権限で実行</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>pwsh</span> <span style=color:#aa89ea>-command</span> <span style=color:#63c381>&#34;Start-Process -Verb runas </span><span style=color:#dcaeea>$program</span><span style=color:#63c381>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># 関数をAliasとして登録する</span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>Set-Alias</span> <span style=color:#aa89ea>-Name</span> <span style=color:#aa89ea>sudo</span> <span style=color:#aa89ea>-Value</span> <span style=color:#aa89ea>SudoRun</span>
</span></span></code></pre></div><p>これを書いたら、そっとそのファイルとPowershellを閉じましょう。<br>その後、Powershellを起動すると、もうあなたは<code>sudo</code>をPowershellで使うことができます!</p><h2 id=問題点>問題点
<a class=heading-link href=#%e5%95%8f%e9%a1%8c%e7%82%b9><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>これはBashから見れば、なんちゃって<code>sudo</code>です。<br>あくまで管理者権限でコマンドを別インスタンスで実行しているだけなので、出力は表示されません&mldr;<br>例えば、</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#aa89ea>sudo</span> <span style=color:#e5c07b>pwd
</span></span></span></code></pre></div><p>とやっても、一瞬pwdの黒い画面が現れるだけです。<br>ここは改善の余地がありそうなので出来たら報告します。</p><h2 id=まとめ>まとめ
<a class=heading-link href=#%e3%81%be%e3%81%a8%e3%82%81><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>WindowsのパッケージマネージャーのChocolateryは実行に管理者権限が必要で、
その度にGUIで"管理者として実行"を押すのが億劫でした。<br><code>sudo</code>がPowershellで使えるようになると本当に便利です!</p><h2 id=参考>参考
<a class=heading-link href=#%e5%8f%82%e8%80%83><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p><a href=https://mimumimu.net/blog/2014/12/11/windows-%E3%81%A7-sudo-%E3%81%AA%E3%81%93%E3%81%A8%E3%82%92%E3%81%99%E3%82%8B%E3%80%82/ class=external-link target=_blank rel=noopener>Windows で sudo なことをする。</a></p></div><footer><div class=comments><script>let getTheme=window.localStorage&&window.localStorage.getItem("colorscheme"),themeInParams="";getTheme==null&&(themeInParams!==""&&themeInParams!=="auto"?getTheme=themeInParams:getTheme=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");let theme=getTheme==="dark"?"github-dark":"github-light",s=document.createElement("script");s.src="https://utteranc.es/client.js",s.setAttribute("repo","caphosra/caphosra.github.io"),s.setAttribute("issue-term","title"),s.setAttribute("theme",theme),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",""),document.querySelector("div.comments").innerHTML="",document.querySelector("div.comments").appendChild(s)</script></div></footer></article></section></div><footer class=footer><section class=container><p>Footer? なにそれ美味しいの?</p>© 2019 - 2024
caphosra</section></footer></main></body></html>