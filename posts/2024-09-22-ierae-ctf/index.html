<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="caphosra"><meta name=description content="IERAE CTF 2024にTSGとして参加したのでwriteupを公開します."><meta name=keywords content="ctf,ierae,ierae ctf 2024,writeup"><meta name=twitter:card content="summary"><meta name=twitter:image content="https://caphosra.net/images/icon.webp"><meta name=twitter:title content="[CTF] IERAE CTF 2024 writeup"><meta name=twitter:description content="IERAE CTF 2024にTSGとして参加したのでwriteupを公開します."><meta property="og:url" content="https://caphosra.net/posts/2024-09-22-ierae-ctf/"><meta property="og:site_name" content="caphosra note"><meta property="og:title" content="[CTF] IERAE CTF 2024 writeup"><meta property="og:description" content="IERAE CTF 2024にTSGとして参加したのでwriteupを公開します."><meta property="og:locale" content="ja"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-22T16:10:12+09:00"><meta property="article:modified_time" content="2024-11-25T23:59:53+09:00"><meta property="article:tag" content="CTF"><base href=https://caphosra.net/posts/2024-09-22-ierae-ctf/><title>[CTF] IERAE CTF 2024 writeup · caphosra note
</title><link rel=canonical href=https://caphosra.net/posts/2024-09-22-ierae-ctf/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous><style defer>@import 'https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&display=swap'</style><link rel=stylesheet href=https://caphosra.net/css/coder.min.70f3e69b472ec0878dad3a4928700ac7d4dc99e9a09a656210c5862dcf0acfe7.css integrity="sha256-cPPmm0cuwIeNrTpJKHAKx9TcmemgmmViEMWGLc8Kz+c=" crossorigin=anonymous media=screen><script src=https://cdn.jsdelivr.net/npm/gist-embed@1.0.3/dist/gist-embed.min.js defer></script><link rel=icon type=image/png href=https://caphosra.net/images/logo/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://caphosra.net/images/logo/favicon-16x16.png sizes=16x16><meta name=generator content="Hugo 0.139.3"><style type=text/css>.icon{font-size:2.5em}</style></head><body class=colorscheme-light><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://caphosra.net/>caphosra note
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://caphosra.net/>About</a></li><li class=navigation-item><a class=navigation-link href=https://caphosra.net/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=https://caphosra.net/tags/>Tags</a></li><li class=navigation-item><a class=navigation-link href=https://caphosra.net/archives/>Archives</a></li><li class=navigation-item><a class=navigation-link href=https://github.com/caphosra>GitHub</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=https://caphosra.net/en/>English</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://caphosra.net/posts/2024-09-22-ierae-ctf/>[CTF] IERAE CTF 2024 writeup</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2024-09-22T16:10:12+09:00>9月 22, 2024
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
4分で読めます</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=https://caphosra.net/tags/ctf/>CTF</a></span></div></div></header><div class=post-content><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><p>caphosraです. IERAE CTF 2024にTSGとして参加しました. Cryptoのderangement, Weak PRNGとmiscのgnalangの計3問解いたのでwriteupを書きたいと思います.</p><p>分量と難易度的にgnalangのwriteupがメインになります.</p><h2 id=crypto-derangement>Crypto: derangement
<a class=heading-link href=#crypto-derangement><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>長さ15のランダムな文字列をランダムに並べ替えたものが与えられ, その元の文字列を求める問題. 並び替えた文字列のどの文字も元の文字列と異なることが保証されている.</p><p>とりあえず回数上限近くまで並べ替え後の文字列を受け取って, 各 \(i\) 文字目についてありえない文字のリストを構成する. その上で, そのリストに含まれていない文字を順に並べていけば良い.</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8a93a5;font-weight:700;font-style:italic>#!/usr/bin/python3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>from</span> <span style=color:#ca72ff>ptrlib</span> <span style=color:#76a9f9>import</span> <span style=color:#54b1c7>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>proc</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>Socket</span><span style=color:#abb2bf>(</span><span style=color:#63c381>&#34;XXX.XXX.XXX.XXX&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>55555</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>LENGTH</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>15</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>LOOP</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>280</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>banned</span> <span style=color:#54b1c7>=</span> <span style=color:#e5c07b>list</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>for</span> <span style=color:#aa89ea>_</span> <span style=color:#b756ff;font-weight:700>in</span> <span style=color:#e5c07b>range</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>LENGTH</span><span style=color:#abb2bf>):</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>banned</span><span style=color:#54b1c7>.</span><span style=color:#aa89ea>append</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>list</span><span style=color:#abb2bf>())</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>word</span> <span style=color:#54b1c7>=</span> <span style=color:#e5c07b>None</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>for</span> <span style=color:#aa89ea>_</span> <span style=color:#b756ff;font-weight:700>in</span> <span style=color:#e5c07b>range</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>LOOP</span><span style=color:#abb2bf>):</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>proc</span><span style=color:#54b1c7>.</span><span style=color:#aa89ea>sendlineafter</span><span style=color:#abb2bf>(</span><span style=color:#63c381>&#34;&gt; &#34;</span><span style=color:#abb2bf>,</span> <span style=color:#63c381>&#34;1&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>proc</span><span style=color:#54b1c7>.</span><span style=color:#aa89ea>recvuntil</span><span style=color:#abb2bf>(</span><span style=color:#63c381>&#34;hint: &#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>hint</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>proc</span><span style=color:#54b1c7>.</span><span style=color:#aa89ea>recvline</span><span style=color:#abb2bf>()</span><span style=color:#54b1c7>.</span><span style=color:#aa89ea>decode</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>if</span> <span style=color:#b756ff;font-weight:700>not</span> <span style=color:#aa89ea>word</span><span style=color:#abb2bf>:</span>
</span></span><span style=display:flex><span>       <span style=color:#aa89ea>word</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>hint</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>assert</span> <span style=color:#e5c07b>len</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>hint</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>==</span> <span style=color:#aa89ea>LENGTH</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>for</span> <span style=color:#aa89ea>i</span> <span style=color:#b756ff;font-weight:700>in</span> <span style=color:#e5c07b>range</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>LENGTH</span><span style=color:#abb2bf>):</span>
</span></span><span style=display:flex><span>        <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>hint</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>i</span><span style=color:#abb2bf>]</span> <span style=color:#b756ff;font-weight:700>not</span> <span style=color:#b756ff;font-weight:700>in</span> <span style=color:#aa89ea>banned</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>i</span><span style=color:#abb2bf>]:</span>
</span></span><span style=display:flex><span>            <span style=color:#aa89ea>banned</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>i</span><span style=color:#abb2bf>]</span><span style=color:#54b1c7>.</span><span style=color:#aa89ea>append</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>hint</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>i</span><span style=color:#abb2bf>])</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>determined</span> <span style=color:#54b1c7>=</span> <span style=color:#63c381>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>for</span> <span style=color:#aa89ea>i</span> <span style=color:#b756ff;font-weight:700>in</span> <span style=color:#e5c07b>range</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>LENGTH</span><span style=color:#abb2bf>):</span>
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>print</span><span style=color:#abb2bf>(</span><span style=color:#98c379>f</span><span style=color:#63c381>&#34;len(banned[</span><span style=color:#98c379>{</span><span style=color:#aa89ea>i</span><span style=color:#98c379>}</span><span style=color:#63c381>]) = </span><span style=color:#98c379>{</span><span style=color:#e5c07b>len</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>banned</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>i</span><span style=color:#abb2bf>])</span><span style=color:#98c379>}</span><span style=color:#63c381>&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>if</span> <span style=color:#e5c07b>len</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>banned</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>i</span><span style=color:#abb2bf>])</span> <span style=color:#54b1c7>!=</span> <span style=color:#aa89ea>LENGTH</span> <span style=color:#54b1c7>-</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>:</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>proc</span><span style=color:#54b1c7>.</span><span style=color:#aa89ea>close</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>for</span> <span style=color:#aa89ea>c</span> <span style=color:#b756ff;font-weight:700>in</span> <span style=color:#aa89ea>word</span><span style=color:#abb2bf>:</span>
</span></span><span style=display:flex><span>        <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>c</span> <span style=color:#b756ff;font-weight:700>not</span> <span style=color:#b756ff;font-weight:700>in</span> <span style=color:#aa89ea>banned</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>i</span><span style=color:#abb2bf>]:</span>
</span></span><span style=display:flex><span>            <span style=color:#aa89ea>determined</span> <span style=color:#54b1c7>+=</span> <span style=color:#aa89ea>c</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>print</span><span style=color:#abb2bf>(</span><span style=color:#98c379>f</span><span style=color:#63c381>&#34;magic word = </span><span style=color:#98c379>{</span><span style=color:#aa89ea>determined</span><span style=color:#98c379>}</span><span style=color:#63c381>&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>proc</span><span style=color:#54b1c7>.</span><span style=color:#aa89ea>sendlineafter</span><span style=color:#abb2bf>(</span><span style=color:#63c381>&#34;&gt; &#34;</span><span style=color:#abb2bf>,</span> <span style=color:#63c381>&#34;2&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>proc</span><span style=color:#54b1c7>.</span><span style=color:#aa89ea>sendlineafter</span><span style=color:#abb2bf>(</span><span style=color:#63c381>&#34;&gt; &#34;</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>determined</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>proc</span><span style=color:#54b1c7>.</span><span style=color:#aa89ea>interactive</span><span style=color:#abb2bf>()</span>
</span></span></code></pre></div><p>実行結果は以下の通り.</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>$ ./exploit.py
</span></span><span style=display:flex><span>[+] __init__: Successfully connected to XXX.XXX.XXX.XXX:55555
</span></span><span style=display:flex><span>len(banned[0]) = 14
</span></span><span style=display:flex><span>len(banned[1]) = 14
</span></span><span style=display:flex><span>len(banned[2]) = 14
</span></span><span style=display:flex><span>len(banned[3]) = 14
</span></span><span style=display:flex><span>len(banned[4]) = 14
</span></span><span style=display:flex><span>len(banned[5]) = 14
</span></span><span style=display:flex><span>len(banned[6]) = 14
</span></span><span style=display:flex><span>len(banned[7]) = 14
</span></span><span style=display:flex><span>len(banned[8]) = 14
</span></span><span style=display:flex><span>len(banned[9]) = 14
</span></span><span style=display:flex><span>len(banned[10]) = 14
</span></span><span style=display:flex><span>len(banned[11]) = 14
</span></span><span style=display:flex><span>len(banned[12]) = 14
</span></span><span style=display:flex><span>len(banned[13]) = 14
</span></span><span style=display:flex><span>len(banned[14]) = 14
</span></span><span style=display:flex><span>magic word = t`2KQ#yWR}:J_j\
</span></span><span style=display:flex><span>[ptrlib]$ Congrats!
</span></span><span style=display:flex><span> IERAE{th3r35_n0_5uch_th!ng_45_p3rf3ct_3ncrypt!0n}
</span></span><span style=display:flex><span>Connection limit reached. Exiting...
</span></span></code></pre></div><p>FLAG: <code>IERAE{th3r35_n0_5uch_th!ng_45_p3rf3ct_3ncrypt!0n}</code></p><h2 id=crypto-weak-prng>Crypto: Weak PRNG
<a class=heading-link href=#crypto-weak-prng><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>Pythonの<code>random</code>モジュールの<code>getrandbits(32)</code>を使って生成された乱数がいくつか与えられるので, それより前に生成された乱数を推測してください, という問題.</p><p>検索すると, <a href=https://zenn.dev/hk_ilohas/articles/mersenne-twister-previous-state class=external-link target=_blank rel=noopener>まんまな記事</a>があったのでそのコードを<del>ほぼ丸パクリ</del>参考にして解いた.</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8a93a5;font-weight:700;font-style:italic>#!/usr/bin/python3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># Referenced: https://zenn.dev/hk_ilohas/articles/mersenne-twister-previous-state</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>#</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>from</span> <span style=color:#ca72ff>ptrlib</span> <span style=color:#76a9f9>import</span> <span style=color:#54b1c7>*</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>import</span> <span style=color:#ca72ff>random</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>proc</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>Socket</span><span style=color:#abb2bf>(</span><span style=color:#63c381>&#34;XXX.XXX.XXX.XXX&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>19937</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># Basic operations</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>def</span> <span style=color:#00b1f7>untemper</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>x</span><span style=color:#abb2bf>):</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>x</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>un_bitshift_right_xor</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>x</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>18</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>x</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>un_bitshift_left_xor</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>x</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>15</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>0xefc60000</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>x</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>un_bitshift_left_xor</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>x</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>7</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>0x9d2c5680</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>x</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>un_bitshift_right_xor</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>x</span><span style=color:#abb2bf>,</span> <span style=color:#d19a66>11</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>x</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>def</span> <span style=color:#00b1f7>un_bitshift_right_xor</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>x</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>shift</span><span style=color:#abb2bf>):</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>i</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>y</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>x</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>while</span> <span style=color:#aa89ea>i</span> <span style=color:#54b1c7>*</span> <span style=color:#aa89ea>shift</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#d19a66>32</span><span style=color:#abb2bf>:</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>z</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>y</span> <span style=color:#54b1c7>&gt;&gt;</span> <span style=color:#aa89ea>shift</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>y</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>x</span> <span style=color:#54b1c7>^</span> <span style=color:#aa89ea>z</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>i</span> <span style=color:#54b1c7>+=</span> <span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>y</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>def</span> <span style=color:#00b1f7>un_bitshift_left_xor</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>x</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>shift</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>mask</span><span style=color:#abb2bf>):</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>i</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>y</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>x</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>while</span> <span style=color:#aa89ea>i</span> <span style=color:#54b1c7>*</span> <span style=color:#aa89ea>shift</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#d19a66>32</span><span style=color:#abb2bf>:</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>z</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>y</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#aa89ea>shift</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>y</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>x</span> <span style=color:#54b1c7>^</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>z</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#aa89ea>mask</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>i</span> <span style=color:#54b1c7>+=</span> <span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>y</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>def</span> <span style=color:#00b1f7>get_prev_state</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>state</span><span style=color:#abb2bf>):</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>for</span> <span style=color:#aa89ea>i</span> <span style=color:#b756ff;font-weight:700>in</span> <span style=color:#e5c07b>range</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>623</span><span style=color:#abb2bf>,</span> <span style=color:#54b1c7>-</span><span style=color:#d19a66>1</span><span style=color:#abb2bf>,</span> <span style=color:#54b1c7>-</span><span style=color:#d19a66>1</span><span style=color:#abb2bf>):</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>result</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>tmp</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>state</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>i</span><span style=color:#abb2bf>]</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>tmp</span> <span style=color:#54b1c7>^=</span> <span style=color:#aa89ea>state</span><span style=color:#abb2bf>[(</span><span style=color:#aa89ea>i</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>397</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>%</span> <span style=color:#d19a66>624</span><span style=color:#abb2bf>]</span>
</span></span><span style=display:flex><span>        <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>((</span><span style=color:#aa89ea>tmp</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0x80000000</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>0x80000000</span><span style=color:#abb2bf>):</span>
</span></span><span style=display:flex><span>            <span style=color:#aa89ea>tmp</span> <span style=color:#54b1c7>^=</span> <span style=color:#d19a66>0x9908b0df</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>result</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>tmp</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0x80000000</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>tmp</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>state</span><span style=color:#abb2bf>[(</span><span style=color:#aa89ea>i</span> <span style=color:#54b1c7>-</span> <span style=color:#d19a66>1</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>624</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>%</span> <span style=color:#d19a66>624</span><span style=color:#abb2bf>]</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>tmp</span> <span style=color:#54b1c7>^=</span> <span style=color:#aa89ea>state</span><span style=color:#abb2bf>[(</span><span style=color:#aa89ea>i</span> <span style=color:#54b1c7>+</span> <span style=color:#d19a66>396</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>%</span> <span style=color:#d19a66>624</span><span style=color:#abb2bf>]</span>
</span></span><span style=display:flex><span>        <span style=color:#76a9f9>if</span> <span style=color:#abb2bf>((</span><span style=color:#aa89ea>tmp</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0x80000000</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>==</span> <span style=color:#d19a66>0x80000000</span><span style=color:#abb2bf>):</span>
</span></span><span style=display:flex><span>            <span style=color:#aa89ea>tmp</span> <span style=color:#54b1c7>^=</span> <span style=color:#d19a66>0x9908b0df</span>
</span></span><span style=display:flex><span>            <span style=color:#aa89ea>result</span> <span style=color:#54b1c7>|=</span> <span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>result</span> <span style=color:#54b1c7>|=</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>tmp</span> <span style=color:#54b1c7>&lt;&lt;</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>)</span> <span style=color:#54b1c7>&amp;</span> <span style=color:#d19a66>0x7fffffff</span>
</span></span><span style=display:flex><span>        <span style=color:#aa89ea>state</span><span style=color:#abb2bf>[</span><span style=color:#aa89ea>i</span><span style=color:#abb2bf>]</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>result</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>return</span> <span style=color:#aa89ea>state</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># Main</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>nums</span> <span style=color:#54b1c7>=</span> <span style=color:#e5c07b>list</span><span style=color:#abb2bf>()</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>collected</span> <span style=color:#54b1c7>=</span> <span style=color:#d19a66>0</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>while</span> <span style=color:#aa89ea>collected</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#d19a66>624</span><span style=color:#abb2bf>:</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>proc</span><span style=color:#54b1c7>.</span><span style=color:#aa89ea>sendlineafter</span><span style=color:#abb2bf>(</span><span style=color:#63c381>&#34;&gt; &#34;</span><span style=color:#abb2bf>,</span> <span style=color:#63c381>&#34;1&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>proc</span><span style=color:#54b1c7>.</span><span style=color:#aa89ea>recvuntil</span><span style=color:#abb2bf>(</span><span style=color:#63c381>&#34;data:</span><span style=color:#d26464;font-weight:700>\n</span><span style=color:#63c381>&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>for</span> <span style=color:#aa89ea>_</span> <span style=color:#b756ff;font-weight:700>in</span> <span style=color:#e5c07b>range</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>16</span><span style=color:#abb2bf>):</span>
</span></span><span style=display:flex><span>        <span style=color:#76a9f9>if</span> <span style=color:#aa89ea>collected</span> <span style=color:#54b1c7>&lt;</span> <span style=color:#d19a66>624</span><span style=color:#abb2bf>:</span>
</span></span><span style=display:flex><span>            <span style=color:#aa89ea>nums</span><span style=color:#54b1c7>.</span><span style=color:#aa89ea>append</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>int</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>proc</span><span style=color:#54b1c7>.</span><span style=color:#aa89ea>recvline</span><span style=color:#abb2bf>()))</span>
</span></span><span style=display:flex><span>            <span style=color:#aa89ea>collected</span> <span style=color:#54b1c7>+=</span> <span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span>        <span style=color:#76a9f9>else</span><span style=color:#abb2bf>:</span>
</span></span><span style=display:flex><span>            <span style=color:#76a9f9>break</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>mt_state</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>[</span><span style=color:#aa89ea>untemper</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>x</span><span style=color:#abb2bf>)</span> <span style=color:#76a9f9>for</span> <span style=color:#aa89ea>x</span> <span style=color:#b756ff;font-weight:700>in</span> <span style=color:#aa89ea>nums</span><span style=color:#abb2bf>]</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>prev_mt_state</span> <span style=color:#54b1c7>=</span> <span style=color:#aa89ea>get_prev_state</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>mt_state</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>random</span><span style=color:#54b1c7>.</span><span style=color:#aa89ea>setstate</span><span style=color:#abb2bf>((</span><span style=color:#d19a66>3</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>tuple</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>prev_mt_state</span> <span style=color:#54b1c7>+</span> <span style=color:#abb2bf>[</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>]),</span> <span style=color:#e5c07b>None</span><span style=color:#abb2bf>))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>predicted</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>[</span><span style=color:#aa89ea>random</span><span style=color:#54b1c7>.</span><span style=color:#aa89ea>getrandbits</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>32</span><span style=color:#abb2bf>)</span> <span style=color:#76a9f9>for</span> <span style=color:#aa89ea>_</span> <span style=color:#b756ff;font-weight:700>in</span> <span style=color:#e5c07b>range</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>624</span><span style=color:#abb2bf>)]</span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>print</span><span style=color:#abb2bf>(</span><span style=color:#98c379>f</span><span style=color:#63c381>&#34;secret: </span><span style=color:#98c379>{</span><span style=color:#aa89ea>predicted</span><span style=color:#abb2bf>[</span><span style=color:#d19a66>623</span><span style=color:#abb2bf>]</span><span style=color:#98c379>}</span><span style=color:#63c381>&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>proc</span><span style=color:#54b1c7>.</span><span style=color:#aa89ea>sendlineafter</span><span style=color:#abb2bf>(</span><span style=color:#63c381>&#34;&gt; &#34;</span><span style=color:#abb2bf>,</span> <span style=color:#63c381>&#34;2&#34;</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>proc</span><span style=color:#54b1c7>.</span><span style=color:#aa89ea>sendlineafter</span><span style=color:#abb2bf>(</span><span style=color:#63c381>&#34;&gt; &#34;</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>str</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>predicted</span><span style=color:#abb2bf>[</span><span style=color:#d19a66>623</span><span style=color:#abb2bf>]))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>proc</span><span style=color:#54b1c7>.</span><span style=color:#aa89ea>interactive</span><span style=color:#abb2bf>()</span>
</span></span></code></pre></div><p>実行結果は以下の通り.</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>$ ./exploit.py
</span></span><span style=display:flex><span>[+] __init__: Successfully connected to XXX.XXX.XXX.XXX:19937
</span></span><span style=display:flex><span>secret: 2223950067
</span></span><span style=display:flex><span>[ptrlib]$ Correct! Here is your flag:
</span></span><span style=display:flex><span>IERAE{WhY_4r3_n&#39;7_Y0u_u51n6_4_CSPRNG_3v3n_1n_2024}
</span></span></code></pre></div><p>FLAG: <code>IERAE{WhY_4r3_n'7_Y0u_u51n6_4_CSPRNG_3v3n_1n_2024}</code></p><p>ポート番号がちゃんと19937になっているところにこだわりを感じた.</p><h2 id=misc-gnalang>Misc: gnalang
<a class=heading-link href=#misc-gnalang><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>このwriteupのメインディッシュ. 問題設定がとても面白かった. 何してたらこんなに面白い問題が思いつくのか.</p><p>この問題では, 以下を満たすプログラムを構成することが要求される:</p><div class="notice info"><div class=notice-title><i class="fa-solid fa-exclamation-circle" aria-hidden=true></i>Info</div><div class=notice-content><ul><li>与えられた文字列が回文かどうかを判定できる</li><li><strong>Javascriptとして実行してもshellscriptとして実行しても正常終了する (!?!?!?)</strong></li><li><code>$</code>, <code>#</code>, <code>//</code>, <code>&lt;!--</code>, <code>--></code>, <code>\n</code>, 半角スペースを含んではならない (!?!?!?!?!?)</li><li><strong>ソースコード自体が回文である必要がある (!?!?!?!?!?!?!?)</strong></li></ul></div></div><p>いわゆるpolyglotを作る問題に加えて回文である必要があり, しかも行コメントが禁止されているので, ソースコードをすべて反転してコメントアウトしたものを後ろからくっつけるという安直な方法は封じられている. ゆえ, まず回文で実行可能なソースコードを考える必要があると考えた.</p><p>以降登場するソースコード全般において, あまりに読みにくかったので構文を無視して適当な字数で改行を入れた. もちろん, 実際に利用し提出したソースコードに改行は含まれていない.</p><h3 id=1-javascriptで回文になっている回文判定コードを構成する>1. Javascriptで回文になっている回文判定コードを構成する
<a class=heading-link href=#1-javascript%e3%81%a7%e5%9b%9e%e6%96%87%e3%81%ab%e3%81%aa%e3%81%a3%e3%81%a6%e3%81%84%e3%82%8b%e5%9b%9e%e6%96%87%e5%88%a4%e5%ae%9a%e3%82%b3%e3%83%bc%e3%83%89%e3%82%92%e6%a7%8b%e6%88%90%e3%81%99%e3%82%8b><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h3><p>まず, Javascriptでソースコードが回文となっても実行できるものを考える. <code>/* */</code>という形式のコメントが封じられていないのでこれを使ってうまいコードを作れればいいのだが, ここでかなり詰まった. 夕飯時にその場にいたTSGのメンバーに相談し, hakatashiさんから以下のような構成を提案してもらった:</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#aa89ea>m</span><span style=color:#54b1c7>=</span><span style=color:#e5c07b>NaN</span><span style=color:#abb2bf>;</span><span style=color:#aa89ea>m</span><span style=color:#54b1c7>/=</span><span style=color:#d19a66>1</span><span style=color:#8a93a5;font-style:italic>/*)[ereh](*/</span><span style=color:#54b1c7>*</span><span style=color:#abb2bf>([</span><span style=color:#aa89ea>here</span><span style=color:#abb2bf>])</span><span style=color:#54b1c7>*</span><span style=color:#56b6c2>/1=/m</span><span style=color:#abb2bf>;</span><span style=color:#e5c07b>NaN</span><span style=color:#54b1c7>=</span><span style=color:#aa89ea>m</span>
</span></span></code></pre></div><p>なんと上記のコードは回文になっていて, かつ<code>[here]</code>のところに任意の式を入れて実行できる. ちょうど式を反転させた部分がコメントになっているのと, <code>NaN</code>が反転させても<code>NaN</code>で代入してもエラーにならないことがうまく使われている. 賢すぎる. もちろんこれはありがたく使わせてもらった.</p><p>適当な回文判定の式を作り,</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#76a9f9>function</span><span style=color:#abb2bf>(){</span><span style=color:#aa89ea>abc</span><span style=color:#54b1c7>=</span><span style=color:#aa89ea>require</span><span style=color:#abb2bf>(</span><span style=color:#63c381>&#34;fs&#34;</span><span style=color:#abb2bf>).</span><span style=color:#aa89ea>readFileSync</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>,</span><span style=color:#63c381>&#34;utf8&#34;</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>if</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>abc</span><span style=color:#54b1c7>==</span><span style=color:#aa89ea>abc</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>split</span><span style=color:#abb2bf>(</span><span style=color:#63c381>&#34;&#34;</span><span style=color:#abb2bf>).</span><span style=color:#aa89ea>reverse</span><span style=color:#abb2bf>().</span><span style=color:#aa89ea>join</span><span style=color:#abb2bf>(</span><span style=color:#63c381>&#34;&#34;</span><span style=color:#abb2bf>)){</span><span style=color:#aa89ea>console</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>log</span><span style=color:#abb2bf>(</span><span style=color:#63c381>&#34;Yes&#34;</span><span style=color:#abb2bf>)}</span><span style=color:#76a9f9>else</span><span style=color:#abb2bf>{</span><span style=color:#aa89ea>console</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>log</span><span style=color:#abb2bf>(</span><span style=color:#63c381>&#34;No&#34;</span><span style=color:#abb2bf>)}}()</span>
</span></span></code></pre></div><p>先述の雛形に入れ込めば以下のようなコードが完成する.</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#aa89ea>m</span><span style=color:#54b1c7>=</span><span style=color:#e5c07b>NaN</span><span style=color:#abb2bf>;</span><span style=color:#aa89ea>m</span><span style=color:#54b1c7>/=</span><span style=color:#d19a66>1</span><span style=color:#8a93a5;font-style:italic>/*))(}})&#34;oN&#34;(gol.elosnoc{esle})&#34;seY&#34;(gol.elosnoc{))&#34;&#34;(nioj.)
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>(esrever.)&#34;&#34;(tilps.cba==cba(fi;)&#34;8ftu&#34;,0(cnySeliFdaer.)&#34;sf&#34;(eriuqer=cba{)(noitcnuf(*/</span>
</span></span><span style=display:flex><span><span style=color:#54b1c7>*</span><span style=color:#abb2bf>(</span><span style=color:#76a9f9>function</span><span style=color:#abb2bf>(){</span><span style=color:#aa89ea>abc</span><span style=color:#54b1c7>=</span><span style=color:#aa89ea>require</span><span style=color:#abb2bf>(</span><span style=color:#63c381>&#34;fs&#34;</span><span style=color:#abb2bf>).</span><span style=color:#aa89ea>readFileSync</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>,</span><span style=color:#63c381>&#34;utf8&#34;</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>if</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>abc</span><span style=color:#54b1c7>==</span><span style=color:#aa89ea>abc</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>split</span><span style=color:#abb2bf>(</span><span style=color:#63c381>&#34;&#34;</span><span style=color:#abb2bf>).</span><span style=color:#aa89ea>reverse</span><span style=color:#abb2bf>().</span><span style=color:#aa89ea>join</span><span style=color:#abb2bf>(</span><span style=color:#63c381>&#34;&#34;</span><span style=color:#abb2bf>)){</span><span style=color:#aa89ea>console</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>log</span><span style=color:#abb2bf>(</span><span style=color:#63c381>&#34;Yes&#34;</span><span style=color:#abb2bf>)}</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>else</span><span style=color:#abb2bf>{</span><span style=color:#aa89ea>console</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>log</span><span style=color:#abb2bf>(</span><span style=color:#63c381>&#34;No&#34;</span><span style=color:#abb2bf>)}}())</span><span style=color:#54b1c7>*</span><span style=color:#56b6c2>/1=/m</span><span style=color:#abb2bf>;</span><span style=color:#e5c07b>NaN</span><span style=color:#54b1c7>=</span><span style=color:#aa89ea>m</span>
</span></span></code></pre></div><p>文は埋め込めないので, 式にするために関数で包む必要があった.</p><h3 id=2-shellscriptで回文になっている回文判定コードを構成する>2. Shellscriptで回文になっている回文判定コードを構成する
<a class=heading-link href=#2-shellscript%e3%81%a7%e5%9b%9e%e6%96%87%e3%81%ab%e3%81%aa%e3%81%a3%e3%81%a6%e3%81%84%e3%82%8b%e5%9b%9e%e6%96%87%e5%88%a4%e5%ae%9a%e3%82%b3%e3%83%bc%e3%83%89%e3%82%92%e6%a7%8b%e6%88%90%e3%81%99%e3%82%8b><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h3><p>Shellscriptの場合, ソースコードを回文にするのはJavascriptより簡単だった. <code>exit</code>を使って途中で抜け出してしまえば, あとは構文さえ守っていればエラー落ちすることはないからだ. つまり,</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#54b1c7>[</span>here<span style=color:#54b1c7>]</span><span style=color:#abb2bf>;</span>exit<span style=color:#abb2bf>;</span>tixe<span style=color:#abb2bf>;</span><span style=color:#54b1c7>[</span>ereh<span style=color:#54b1c7>]</span>
</span></span></code></pre></div><p>とすればよい.</p><p>それよりも問題なのは, <code>$</code>を使わずに標準入力を取ってきて回文判定できるかどうかである. この問題はまともに取り組むと大変そうなので, 愚直実装をbase64でencodeしたもの埋め込んで, それを実行時に<code>eval</code>する方針をとった.</p><p>愚直実装は以下の通り.</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#dcaeea>a</span><span style=color:#54b1c7>=</span><span style=color:#98c379>`</span>cat -<span style=color:#98c379>`</span><span style=color:#abb2bf>;</span><span style=color:#dcaeea>b</span><span style=color:#54b1c7>=</span><span style=color:#98c379>`</span><span style=color:#e5c07b>echo</span> <span style=color:#dcaeea>$a</span><span style=color:#abb2bf>|</span>rev<span style=color:#98c379>`</span><span style=color:#abb2bf>;</span><span style=color:#76a9f9>if</span> <span style=color:#54b1c7>[</span> <span style=color:#63c381>&#34;</span><span style=color:#dcaeea>$a</span><span style=color:#63c381>&#34;</span> <span style=color:#54b1c7>=</span> <span style=color:#63c381>&#34;</span><span style=color:#dcaeea>$b</span><span style=color:#63c381>&#34;</span> <span style=color:#54b1c7>]</span><span style=color:#abb2bf>;</span> <span style=color:#76a9f9>then</span> <span style=color:#e5c07b>echo</span> <span style=color:#63c381>&#34;Yes&#34;</span><span style=color:#abb2bf>;</span> <span style=color:#76a9f9>else</span> <span style=color:#e5c07b>echo</span> <span style=color:#63c381>&#34;No&#34;</span><span style=color:#abb2bf>;</span> <span style=color:#76a9f9>fi</span>
</span></span></code></pre></div><p>あとはこれをbase64でencodeしたものをつかって,</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#e5c07b>eval</span> <span style=color:#98c379>`</span><span style=color:#e5c07b>echo</span> -n <span style=color:#63c381>&#34;YT1gY2F0IC1gO2I9YGVjaG8gJGF8cmV2YDtpZiBbICIkYSIgPSAiJGIiIF07IHRoZW4gZWNobyAiWWVzIjsgZWxzZSBlY2hvICJObyI7IGZp&#34;</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>|</span> base64 -d<span style=color:#98c379>`</span><span style=color:#abb2bf>;</span><span style=color:#e5c07b>exit</span>
</span></span></code></pre></div><p>これを反転させたものを後ろにつなぎ, 半角スペースをタブに置き換えれば, 条件を満たす回文コードが完成する.</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#e5c07b>eval</span>	<span style=color:#98c379>`</span><span style=color:#e5c07b>echo</span>	-n	<span style=color:#63c381>&#34;YT1gY2F0IC1gO2I9YGVjaG8gJGF8cmV2YDtpZiBbICIkYSIgPSAiJGIiIF07IHRoZW4gZWNobyAiWWVzIjsgZWxzZSBlY2hvICJObyI7IGZp&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#abb2bf>|</span>	base64	-d<span style=color:#98c379>`</span><span style=color:#abb2bf>;</span>exit<span style=color:#abb2bf>;</span>tixe<span style=color:#abb2bf>;</span><span style=color:#98c379>`</span>d-	46esab	<span style=color:#abb2bf>|</span>
</span></span><span style=display:flex><span>	<span style=color:#63c381>&#34;pZGI7IybOJCIvh2YlBSZzxWZgsjIzVWWiAyboNWZg4WZoRHI70FIiIGJiASPgISYkICIbBiZptDY2Vmc8FGJg8GajVGY9I2Og1CI0F2Yg1TY&#34;</span>	n-	ohce<span style=color:#98c379>`</span>	lave
</span></span></code></pre></div><h3 id=3-合体する>3. 合体する
<a class=heading-link href=#3-%e5%90%88%e4%bd%93%e3%81%99%e3%82%8b><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h3><p>あとはこれらのコードを合体させたい. 色々考えた結果, 以下のようなものにたどり着いた.</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#dcaeea>a</span><span style=color:#54b1c7>=</span>/*<span style=color:#abb2bf>;</span><span style=color:#54b1c7>[</span>shell<span style=color:#54b1c7>]</span><span style=color:#abb2bf>;</span><span style=color:#63c381>&#34;*/NaN;[js];NaN/*&#34;</span><span style=color:#abb2bf>;</span><span style=color:#54b1c7>[</span>llehs<span style=color:#54b1c7>]</span><span style=color:#abb2bf>;</span>*/<span style=color:#54b1c7>=</span>a
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#aa89ea>a</span><span style=color:#54b1c7>=</span><span style=color:#8a93a5;font-style:italic>/*;[shell];&#34;*/</span><span style=color:#e5c07b>NaN</span><span style=color:#abb2bf>;[</span><span style=color:#aa89ea>js</span><span style=color:#abb2bf>];</span><span style=color:#e5c07b>NaN</span><span style=color:#8a93a5;font-style:italic>/*&#34;;[llehs];*/</span><span style=color:#54b1c7>=</span><span style=color:#aa89ea>a</span>
</span></span></code></pre></div><p><code>[shell]</code>の部分と<code>[js]</code>の部分は適当にJavascriptとshellscriptに読み替えてもらいたい.</p><p>この式はshellscriptとして解釈すると, <code>a</code>にワイルドカードを使ったパス<code>/*</code>を代入してから<code>[shell]</code>部を実行する流れとなっている. <code>[shell]</code>内で<code>exit</code>しまえば, あとは構文エラーがなければ何が来ても良いのだが, そこでJavascriptのコードが邪魔をしてくる. その対策として, ダブルクオーテーションで<code>[js]</code>部を囲ってしまうことで正常終了するようにしている.</p><p>Javascriptとして解釈する場合はちょうど<code>/* */</code>で<code>[shell]</code>部とその他細々としたものがコメントアウトされるので正常に動作する.</p><p>以上を踏まえて2つのコードを合体させると以下のようになる.</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#aa89ea>a</span><span style=color:#54b1c7>=</span><span style=color:#8a93a5;font-style:italic>/*;eval	`echo	-n	&#34;YT1gY2F0IC1gO2I9YGVjaG8gJGF8cmV2YDtpZiBbICIkYSIgPSAiJGIiIF07IHRoZW4gZWNobyAiWWVzIjsgZWxzZSBlY2hvICJObyI7IGZp&#34;
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>	|	base64	-d`;exit;&#34;*/</span><span style=color:#e5c07b>NaN</span><span style=color:#abb2bf>;</span><span style=color:#aa89ea>m</span><span style=color:#54b1c7>=</span><span style=color:#e5c07b>NaN</span><span style=color:#abb2bf>;</span><span style=color:#aa89ea>m</span><span style=color:#54b1c7>/=</span><span style=color:#d19a66>1</span><span style=color:#8a93a5;font-style:italic>/*))(}})&#34;oN&#34;(gol.elosnoc{esle
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>})&#34;seY&#34;(gol.elosnoc{))&#34;&#34;(nioj.)(esrever.)&#34;&#34;(tilps.cba==cba(fi
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>;)&#34;8ftu&#34;,0(cnySeliFdaer.)&#34;sf&#34;(eriuqer=cba{)(noitcnuf(*/</span>
</span></span><span style=display:flex><span><span style=color:#54b1c7>*</span><span style=color:#abb2bf>(</span><span style=color:#76a9f9>function</span><span style=color:#abb2bf>(){</span><span style=color:#aa89ea>abc</span><span style=color:#54b1c7>=</span><span style=color:#aa89ea>require</span><span style=color:#abb2bf>(</span><span style=color:#63c381>&#34;fs&#34;</span><span style=color:#abb2bf>).</span><span style=color:#aa89ea>readFileSync</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>0</span><span style=color:#abb2bf>,</span><span style=color:#63c381>&#34;utf8&#34;</span><span style=color:#abb2bf>);</span><span style=color:#76a9f9>if</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>abc</span><span style=color:#54b1c7>==</span><span style=color:#aa89ea>abc</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>split</span><span style=color:#abb2bf>(</span><span style=color:#63c381>&#34;&#34;</span><span style=color:#abb2bf>).</span><span style=color:#aa89ea>reverse</span><span style=color:#abb2bf>().</span><span style=color:#aa89ea>join</span><span style=color:#abb2bf>(</span><span style=color:#63c381>&#34;&#34;</span><span style=color:#abb2bf>)){</span><span style=color:#aa89ea>console</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>log</span><span style=color:#abb2bf>(</span><span style=color:#63c381>&#34;Yes&#34;</span><span style=color:#abb2bf>)}</span><span style=color:#76a9f9>else</span><span style=color:#abb2bf>{</span><span style=color:#aa89ea>console</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>log</span><span style=color:#abb2bf>(</span><span style=color:#63c381>&#34;No&#34;</span><span style=color:#abb2bf>)}}())</span>
</span></span><span style=display:flex><span><span style=color:#54b1c7>*</span><span style=color:#56b6c2>/1=/m</span><span style=color:#abb2bf>;</span><span style=color:#e5c07b>NaN</span><span style=color:#54b1c7>=</span><span style=color:#aa89ea>m</span><span style=color:#abb2bf>;</span><span style=color:#e5c07b>NaN</span><span style=color:#8a93a5;font-style:italic>/*&#34;;tixe;`d-	46esab	|
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>	&#34;pZGI7IybOJCIvh2YlBSZzxWZgsjIzVWWiAyboNWZg4WZoRHI70FIiIGJiASPgISYkICIbBiZptDY2Vmc8FGJg8GajVGY9I2Og1CI0F2Yg1TY&#34;	n-	ohce`	lave;*/</span><span style=color:#54b1c7>=</span><span style=color:#aa89ea>a</span>
</span></span></code></pre></div><p>上ではJavascriptとしてsyntax highlightしたが, shellにするとこんな感じ.</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#dcaeea>a</span><span style=color:#54b1c7>=</span>/*<span style=color:#abb2bf>;</span><span style=color:#e5c07b>eval</span>	<span style=color:#98c379>`</span><span style=color:#e5c07b>echo</span>	-n	<span style=color:#63c381>&#34;YT1gY2F0IC1gO2I9YGVjaG8gJGF8cmV2YDtpZiBbICIkYSIgPSAiJGIiIF07IHRoZW4gZWNobyAiWWVzIjsgZWxzZSBlY2hvICJObyI7IGZp&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#abb2bf>|</span>	base64	-d<span style=color:#98c379>`</span><span style=color:#abb2bf>;</span>exit<span style=color:#abb2bf>;</span><span style=color:#63c381>&#34;*/NaN;m=NaN;m/=1/*))(}})&#34;</span>oN<span style=color:#63c381>&#34;(gol.elosnoc{esle
</span></span></span><span style=display:flex><span><span style=color:#63c381>})&#34;</span>seY<span style=color:#63c381>&#34;(gol.elosnoc{))&#34;&#34;(nioj.)(esrever.)&#34;&#34;(tilps.cba==cba(fi
</span></span></span><span style=display:flex><span><span style=color:#63c381>;)&#34;</span>8ftu<span style=color:#63c381>&#34;,0(cnySeliFdaer.)&#34;</span>sf<span style=color:#63c381>&#34;(eriuqer=cba{)(noitcnuf(*/
</span></span></span><span style=display:flex><span><span style=color:#63c381>*(function(){abc=require(&#34;</span>fs<span style=color:#63c381>&#34;).readFileSync(0,&#34;</span>utf8<span style=color:#63c381>&#34;);if(abc==abc.split(&#34;&#34;).reverse().join(&#34;&#34;)){console.log(&#34;</span>Yes<span style=color:#63c381>&#34;)}else{console.log(&#34;</span>No<span style=color:#63c381>&#34;)}}())
</span></span></span><span style=display:flex><span><span style=color:#63c381>*/1=/m;NaN=m;NaN/*&#34;</span><span style=color:#abb2bf>;</span>tixe<span style=color:#abb2bf>;</span><span style=color:#98c379>`</span>d-	46esab	<span style=color:#abb2bf>|</span>
</span></span><span style=display:flex><span>	<span style=color:#63c381>&#34;pZGI7IybOJCIvh2YlBSZzxWZgsjIzVWWiAyboNWZg4WZoRHI70FIiIGJiASPgISYkICIbBiZptDY2Vmc8FGJg8GajVGY9I2Og1CI0F2Yg1TY&#34;</span>	n-	ohce<span style=color:#98c379>`</span>	lave<span style=color:#abb2bf>;</span>*/<span style=color:#54b1c7>=</span>a
</span></span></code></pre></div><p>競技後に改めて見ると余計な部分が多いが, とりあえずこれですべての条件を満たすコードが完成した.</p><p>FLAG: <code>IERAE{0mg_th3y_4r3_s0_t0re13nt_68a80ad1}</code></p><p>こういうmisc面白い. 面白いと一言で言えてしまうのは喉元過ぎていて熱さを忘れているから, という可能性は大いにある.</p><h2 id=まとめ>まとめ
<a class=heading-link href=#%e3%81%be%e3%81%a8%e3%82%81><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>もっと知識と技術をつけて出直してきます.</p><h2 id=おまけ-時間の使い方>(おまけ) 時間の使い方
<a class=heading-link href=#%e3%81%8a%e3%81%be%e3%81%91-%e6%99%82%e9%96%93%e3%81%ae%e4%bd%bf%e3%81%84%e6%96%b9><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>参戦が若干遅れたのでpwnやrevの簡単な問題はもうすでに別のTSGのメンバーによって解かれていた. そこでとりあえず誰も手をつけていなかったCrypto 2問を片付け, gnalangに手を出して解いた. gnalangはfirst bloodを逃し2番目だった.</p><p>次に5に手を出し, かなり時間を溶かした. 5をうらさんが解いた後は仮眠を挟んでThe Kudryavka Sequenceに移り, そのまま沼らして解くことが出来ずに時間が来てしまった.</p><h2 id=参考>参考
<a class=heading-link href=#%e5%8f%82%e8%80%83><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p><a href=https://zenn.dev/hk_ilohas/articles/mersenne-twister-previous-state class=external-link target=_blank rel=noopener>Mersenne Twister (MT19937) で未来と過去の乱数列を予測してみる【Python】 - Zenn</a></p></div><footer><div class=comments><script>let getTheme=window.localStorage&&window.localStorage.getItem("colorscheme"),themeInParams="";getTheme==null&&(themeInParams!==""&&themeInParams!=="auto"?getTheme=themeInParams:getTheme=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");let theme=getTheme==="dark"?"github-dark":"github-light",s=document.createElement("script");s.src="https://utteranc.es/client.js",s.setAttribute("repo","caphosra/caphosra.github.io"),s.setAttribute("issue-term","title"),s.setAttribute("theme",theme),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",""),document.querySelector("div.comments").innerHTML="",document.querySelector("div.comments").appendChild(s)</script></div></footer></article></section></div><footer class=footer><section class=container><p>Footer? なにそれ美味しいの?</p>© 2019 - 2024
caphosra</section></footer></main></body></html>