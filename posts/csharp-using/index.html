<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="caphosra"><meta name=description content='C#で欠かせない存在の"using"の使い方を四つに分けて紹介したいと思います。'><meta name=keywords content="C#,using,C#8.0,IDisposable"><meta name=twitter:card content="summary"><meta name=twitter:image content="https://caphosra.net/images/icon.webp"><meta name=twitter:title content="C#でのusingの使い方を4つ紹介"><meta name=twitter:description content='C#で欠かせない存在の"using"の使い方を四つに分けて紹介したいと思います。'><meta property="og:url" content="https://caphosra.net/posts/csharp-using/"><meta property="og:site_name" content="caphosra note"><meta property="og:title" content="C#でのusingの使い方を4つ紹介"><meta property="og:description" content='C#で欠かせない存在の"using"の使い方を四つに分けて紹介したいと思います。'><meta property="og:locale" content="ja"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-11-16T16:40:39+09:00"><meta property="article:modified_time" content="2024-01-07T13:58:55+09:00"><meta property="article:tag" content="CSharp"><base href=https://caphosra.net/posts/csharp-using/><title>C#でのusingの使い方を4つ紹介 · caphosra note
</title><link rel=canonical href=https://caphosra.net/posts/csharp-using/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous><style defer>@import 'https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&display=swap'</style><link rel=stylesheet href=https://caphosra.net/css/coder.min.70f3e69b472ec0878dad3a4928700ac7d4dc99e9a09a656210c5862dcf0acfe7.css integrity="sha256-cPPmm0cuwIeNrTpJKHAKx9TcmemgmmViEMWGLc8Kz+c=" crossorigin=anonymous media=screen><script src=https://cdn.jsdelivr.net/npm/gist-embed@1.0.3/dist/gist-embed.min.js defer></script><link rel=icon type=image/png href=https://caphosra.net/images/logo/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://caphosra.net/images/logo/favicon-16x16.png sizes=16x16><meta name=generator content="Hugo 0.139.3"><style type=text/css>.icon{font-size:2.5em}</style></head><body class=colorscheme-light><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://caphosra.net/>caphosra note
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://caphosra.net/>About</a></li><li class=navigation-item><a class=navigation-link href=https://caphosra.net/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=https://caphosra.net/tags/>Tags</a></li><li class=navigation-item><a class=navigation-link href=https://caphosra.net/archives/>Archives</a></li><li class=navigation-item><a class=navigation-link href=https://github.com/caphosra>GitHub</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=https://caphosra.net/en/>English</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://caphosra.net/posts/csharp-using/>C#でのusingの使い方を4つ紹介</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2019-11-16T16:40:39+09:00>11月 16, 2019
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
2分で読めます</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=https://caphosra.net/tags/csharp/>CSharp</a></span></div></div></header><div class=post-content><p>今回はC#で欠かせない存在の<code>using</code>の使い方を四つに分けて紹介したいと思います。<br>早速、始めていきましょう!</p><h2 id=ディレクティブとしてのusing>ディレクティブとしてのusing
<a class=heading-link href=#%e3%83%87%e3%82%a3%e3%83%ac%e3%82%af%e3%83%86%e3%82%a3%e3%83%96%e3%81%a8%e3%81%97%e3%81%a6%e3%81%aeusing><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>C#でusingと言えば最初に思い浮かべるであろう使い方は、やはりディレクティブとしての<code>using</code>でしょう。
usingディレクティブと聞いてピンと来なかった方も以下のコードを見ればわかるはずです。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// これがディレクティブとしてのusing</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>using</span> <span style=color:#ca72ff>System</span><span style=color:#abb2bf>;</span>
</span></span></code></pre></div><p>この<code>using</code>は、異なる名前空間の中にあるモジュールを短い名前で呼び出す為に使用されます。
例えば、ファイルの読み書きをストリームで行いたいときに</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style=display:flex><span><span style=color:#aa89ea>System</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Text</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Encoding</span> <span style=color:#aa89ea>enc</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>System</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Text</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Encoding</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>GetEncoding</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;UTF8&#34;</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>System</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>IO</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>StreamWriter</span> <span style=color:#aa89ea>writer</span> <span style=color:#abb2bf>=</span> <span style=color:#76a9f9>new</span> <span style=color:#aa89ea>System</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>IO</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>StreamWriter</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;./some_file.txt&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>false</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>enc</span><span style=color:#abb2bf>);</span>
</span></span></code></pre></div><p>と書くことはできますが、これでは余りにも冗長で可読性が低くなってしまいます。<br>こんな時こそ<code>using</code>です。<br><code>using</code>を使えば名前空間を省略できます。先ほどの例であれば</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// ファイルの先頭にこれらを書く</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>using</span> <span style=color:#ca72ff>System.Text</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>using</span> <span style=color:#ca72ff>System.IO</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Before</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>System</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Text</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Encoding</span> <span style=color:#aa89ea>enc</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>System</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Text</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Encoding</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>GetEncoding</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;UTF8&#34;</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>System</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>IO</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>StreamWriter</span> <span style=color:#aa89ea>writer</span> <span style=color:#abb2bf>=</span> <span style=color:#76a9f9>new</span> <span style=color:#aa89ea>System</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>IO</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>StreamWriter</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;./some_file.txt&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>false</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>enc</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// After</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>Encoding</span> <span style=color:#aa89ea>enc</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>Encoding</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>GetEncoding</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;UTF8&#34;</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>StreamWriter</span> <span style=color:#aa89ea>writer</span> <span style=color:#abb2bf>=</span> <span style=color:#76a9f9>new</span> <span style=color:#aa89ea>StreamWriter</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;./some_file.txt&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>false</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>enc</span><span style=color:#abb2bf>);</span>
</span></span></code></pre></div><p>なんということでしょう。あんなに読みにくかったコードがこんなに簡潔に!
(今回の内容とは関係ないですがvarを使うともっと読みやすくなります。)</p><h2 id=忘れられがちなusing-static>忘れられがちなusing static
<a class=heading-link href=#%e5%bf%98%e3%82%8c%e3%82%89%e3%82%8c%e3%81%8c%e3%81%a1%e3%81%aausing-static><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>先程の<code>using</code>の派生として<code>using static</code>というものがあります。これは クラス名を省略できるようにする為に使われます。例をあげます。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// ファイルの先頭にこれを書く</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>using</span> <span style=color:#ca72ff>static</span> <span style=color:#aa89ea>System</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Math</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// 半径10の円と同じ面積の正方形の一辺の長さを求めたい</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// Before</span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>double</span> <span style=color:#aa89ea>radius</span> <span style=color:#abb2bf>=</span> <span style=color:#d19a66>10d</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>double</span> <span style=color:#aa89ea>ans</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>Math</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Sqrt</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>radius</span> <span style=color:#abb2bf>*</span> <span style=color:#aa89ea>radius</span> <span style=color:#abb2bf>*</span> <span style=color:#aa89ea>Math</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>PI</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// After</span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>double</span> <span style=color:#aa89ea>radius</span> <span style=color:#abb2bf>=</span> <span style=color:#d19a66>10d</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>double</span> <span style=color:#aa89ea>ans</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>Sqrt</span><span style=color:#abb2bf>(</span><span style=color:#aa89ea>radius</span> <span style=color:#abb2bf>*</span> <span style=color:#aa89ea>radius</span> <span style=color:#abb2bf>*</span> <span style=color:#aa89ea>PI</span><span style=color:#abb2bf>);</span>
</span></span></code></pre></div><p>本来、<code>Math.Sqrt</code> <code>Math.PI</code>と書かなければならない所をこんなにも簡潔に書く事ができます。
<code>using static</code>はその名前の通りstaticなメンバについてのみクラス名を省略できるようになります。
(そうでなかったら色々やばそうですが&mldr;)<br>因みにこの機能はあまり使わない印象です。使うのであれば<code>System.Math</code>か<code>System.Console</code>位でしょうか。</p><h2 id=名前を変えるusing>名前を変えるusing
<a class=heading-link href=#%e5%90%8d%e5%89%8d%e3%82%92%e5%a4%89%e3%81%88%e3%82%8busing><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>ある日、caphosra君は以下のようなを実装しました。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style=display:flex><span><span style=color:#76a9f9>namespace</span> <span style=color:#ca72ff>CapraLib</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#76a9f9>public</span> <span style=color:#76a9f9>class</span> <span style=color:#ca72ff>Random</span>
</span></span><span style=display:flex><span>    <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#8a93a5;font-style:italic>// 乱数を出すよ(噓)</span>
</span></span><span style=display:flex><span>        <span style=color:#76a9f9>public</span> <span style=color:#e5c07b>int</span> <span style=color:#aa89ea>Next</span><span style=color:#abb2bf>(</span><span style=color:#e5c07b>int</span> <span style=color:#aa89ea>maxv</span><span style=color:#abb2bf>)</span>
</span></span><span style=display:flex><span>        <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>            <span style=color:#76a9f9>return</span> <span style=color:#d19a66>0</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>        <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span>
</span></span></code></pre></div><p>そして、以下のようなコードを書きました。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// ファイルの先頭にこれらを書く</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>using</span> <span style=color:#ca72ff>System</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>using</span> <span style=color:#ca72ff>CapraLib</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// 51未満の乱数を出したい...がエラー</span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>int</span> <span style=color:#aa89ea>rndVal</span> <span style=color:#abb2bf>=</span> <span style=color:#76a9f9>new</span> <span style=color:#aa89ea>Random</span><span style=color:#abb2bf>().</span><span style=color:#aa89ea>Next</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>51</span><span style=color:#abb2bf>);</span>
</span></span></code></pre></div><p>もうお分かりでしょう。これは上手く動きません。
ここで参照している<code>Random</code>クラスは<code>System.Random</code>でしょうか?それとも<code>CapraLib.Random</code>?
わかりませんね。</p><p>そこで登場するのが名前を変える<code>using</code>です。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// これが名前を変えるusing</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>using</span> <span style=color:#ca72ff>CapRandom</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>CapraLib</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Random</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>using</span> <span style=color:#ca72ff>SystemRandom</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>System</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Random</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// 51未満の乱数を出したい</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// CapraLib.Randomの気分の時</span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>int</span> <span style=color:#aa89ea>rndVal1</span> <span style=color:#abb2bf>=</span> <span style=color:#76a9f9>new</span> <span style=color:#aa89ea>CapRandom</span><span style=color:#abb2bf>().</span><span style=color:#aa89ea>Next</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>51</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// System.Randomの気分の時</span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>int</span> <span style=color:#aa89ea>rndVal2</span> <span style=color:#abb2bf>=</span> <span style=color:#76a9f9>new</span> <span style=color:#aa89ea>SystemRandom</span><span style=color:#abb2bf>().</span><span style=color:#aa89ea>Next</span><span style=color:#abb2bf>(</span><span style=color:#d19a66>51</span><span style=color:#abb2bf>);</span>
</span></span></code></pre></div><p>これで使い分けができます!</p><p>これはクラスに対して使っていますが、名前空間も同じように名前を変えられます。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// 短い名前に変えられますよ!</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>using</span> <span style=color:#ca72ff>GenericCol</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>System</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Collections</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>Generic</span><span style=color:#abb2bf>;</span>
</span></span></code></pre></div><p>これでとても長い名前空間とおさらばです。</p><h2 id=解放してくれるusing>解放してくれるusing
<a class=heading-link href=#%e8%a7%a3%e6%94%be%e3%81%97%e3%81%a6%e3%81%8f%e3%82%8c%e3%82%8busing><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>これは知っているのと知らないのでは大きく違います。
この<code>using</code>はリソース解放を忘れる事を防止する為に使われます。例を見ていきましょう。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style=display:flex><span><span style=color:#76a9f9>using</span> <span style=color:#ca72ff>System.Text</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>using</span> <span style=color:#ca72ff>System.IO</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>Encoding</span> <span style=color:#aa89ea>enc</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>Encoding</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>GetEncoding</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;UTF8&#34;</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>StreamWriter</span> <span style=color:#aa89ea>writer</span> <span style=color:#abb2bf>=</span> <span style=color:#76a9f9>new</span> <span style=color:#aa89ea>StreamWriter</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;./some_file.txt&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>false</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>enc</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>writer</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>WriteLine</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;I wanna be one of the GREATEST programmers!&#34;</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// writer.Close(); 忘れてる</span>
</span></span></code></pre></div><p>このコード、やばいですね。気付きにくいですが、<code>writer</code>が解放されていません。<br>即ち、ファイルを開きっぱなしでコードが終わっています。開けたら閉めるが基本ですよね。<br><code>writer</code>は<code>Close()</code>という関数を持っているのでこれを最後に呼んであげればいいです、が&mldr;</p><p>この方法だと、とても忘れやすい!</p><p>そこでこの方法。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style=display:flex><span><span style=color:#76a9f9>using</span> <span style=color:#ca72ff>System.Text</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>using</span> <span style=color:#ca72ff>System.IO</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>Encoding</span> <span style=color:#aa89ea>enc</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>Encoding</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>GetEncoding</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;UTF8&#34;</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>using</span> <span style=color:#abb2bf>(</span><span style=color:#aa89ea>StreamWriter</span> <span style=color:#aa89ea>writer</span> <span style=color:#abb2bf>=</span> <span style=color:#76a9f9>new</span> <span style=color:#aa89ea>StreamWriter</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;./some_file.txt&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>false</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>enc</span><span style=color:#abb2bf>))</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#aa89ea>writer</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>WriteLine</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;I wanna be one of the GREATEST programmers!&#34;</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span><span style=color:#abb2bf>}</span> <span style=color:#8a93a5;font-style:italic>// ここでwriter.Dispose()が呼ばれる</span>
</span></span></code></pre></div><p>この<code>using</code>を使えば、中カッコ(スコープ)を抜けたときに<code>Dispose()</code>を呼んでくれます。<br><code>StreamWriter</code>は<code>Close()</code>でも<code>Dispose()</code>でも解放できますので、このコードは正常に動作します。黙っててすみません。</p><p>この記法のメリットは何と言っても、<code>Dispose()</code>の呼び忘れが起こらない事じゃないでしょうか。<br>ついうっかり、でメモリリークすることがないのでこの記法を絶対に使用すべきです。使える時は。</p><p>この<code>using</code>が使えるのはクラスが<code>IDisposable</code>を実装している時のみです。<br><code>IDisposable</code>を実装しているのは<code>StreamWriter</code>以外にも沢山あるので調べてみてください!<br>あと、自分のライブラリとかを作るときに<code>IDisposable</code>を積極的に実装すれば、<code>using</code>好きが沢山使ってくれるかも&mldr;?</p><h2 id=おまけ-c80での解放する為のusing>[おまけ] C#8.0での解放する為のusing
<a class=heading-link href=#%e3%81%8a%e3%81%be%e3%81%91-c80%e3%81%a7%e3%81%ae%e8%a7%a3%e6%94%be%e3%81%99%e3%82%8b%e7%82%ba%e3%81%aeusing><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>C#8.0で解放する為のusingに新たな記法が加わりました。
これを利用すると、以下のように書く事ができます。</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style=display:flex><span><span style=color:#76a9f9>using</span> <span style=color:#ca72ff>System.Text</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>using</span> <span style=color:#ca72ff>System.IO</span><span style=color:#abb2bf>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>Encoding</span> <span style=color:#aa89ea>enc</span> <span style=color:#abb2bf>=</span> <span style=color:#aa89ea>Encoding</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>GetEncoding</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;UTF8&#34;</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span><span style=color:#76a9f9>using</span> <span style=color:#ca72ff>StreamWriter</span> <span style=color:#aa89ea>writer</span> <span style=color:#abb2bf>=</span> <span style=color:#76a9f9>new</span> <span style=color:#aa89ea>StreamWriter</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;./some_file.txt&#34;</span><span style=color:#abb2bf>,</span> <span style=color:#e5c07b>false</span><span style=color:#abb2bf>,</span> <span style=color:#aa89ea>enc</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span><span style=color:#aa89ea>writer</span><span style=color:#abb2bf>.</span><span style=color:#aa89ea>WriteLine</span><span style=color:#abb2bf>(</span><span style=color:#98c379>&#34;I wanna be one of the GREATEST programmers!&#34;</span><span style=color:#abb2bf>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic>// スコープを抜けるとwriter.Dispose()が呼ばれる</span>
</span></span></code></pre></div><p>変数の型の前に置いてある<code>using</code>によって、<code>writer</code>が寿命を迎えたときに<code>Dispose()</code>が呼ばれるようになります。<br>これはとてもcoolな記法ですね。ミスも防げます。</p><h2 id=まとめ>まとめ
<a class=heading-link href=#%e3%81%be%e3%81%a8%e3%82%81><i class="fa-solid fa-link" aria-hidden=true title=見出しへのリンク></i>
<span class=sr-only>見出しへのリンク</span></a></h2><p>いかがだったでしょうか。この記事を読んで、C#のusingにもっと優しくしてあげようかな、と思っていただければ幸いです。<br><del>でも正直using static使わないだろうなぁ</del></p></div><footer><div class=comments><script>let getTheme=window.localStorage&&window.localStorage.getItem("colorscheme"),themeInParams="";getTheme==null&&(themeInParams!==""&&themeInParams!=="auto"?getTheme=themeInParams:getTheme=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");let theme=getTheme==="dark"?"github-dark":"github-light",s=document.createElement("script");s.src="https://utteranc.es/client.js",s.setAttribute("repo","caphosra/caphosra.github.io"),s.setAttribute("issue-term","title"),s.setAttribute("theme",theme),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",""),document.querySelector("div.comments").innerHTML="",document.querySelector("div.comments").appendChild(s)</script></div></footer></article></section></div><footer class=footer><section class=container><p>Footer? なにそれ美味しいの?</p>© 2019 - 2024
caphosra</section></footer></main></body></html>